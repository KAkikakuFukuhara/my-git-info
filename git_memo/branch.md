# branch

ブランチとは、プロジェクトを分岐して記録していく仕組みであり並行作業を実現することができる。  
詳細は次のURLを確認して欲しい[https://backlog.com/ja/git-tutorial/stepup/01/](https://backlog.com/ja/git-tutorial/stepup/01/)
ここはブランチに関しての操作等をまとめたモノを記載していくが、上記のURL等に書いてあるモノを見た方が分かりやすいとは思う。


**目次**
- [1. 基礎](#1-基礎)
  - [1.1. ブランチの作成](#11-ブランチの作成)
  - [1.2. ブランチの移動](#12-ブランチの移動)
  - [1.3. ブランチ上でのコミット](#13-ブランチ上でのコミット)
  - [1.4. 変更の取り込み(Merge)](#14-変更の取り込みmerge)
    - [1.4.1. ローカルのmasterブランチでの変更を取り込む際](#141-ローカルのmasterブランチでの変更を取り込む際)
    - [1.4.2. リモートリポジトリの内容をローカルリポジトリの内容に反映させる](#142-リモートリポジトリの内容をローカルリポジトリの内容に反映させる)
- [2. 作業途中で別のブランチに移動](#2-作業途中で別のブランチに移動)
  - [2.1. 退避](#21-退避)
  - [2.2. 退避作業を見る](#22-退避作業を見る)
  - [2.3. 退避した作業を元に戻す（履歴も削除する）](#23-退避した作業を元に戻す履歴も削除する)
  - [2.4. 退避した作業を元に戻す(履歴は削除しない)](#24-退避した作業を元に戻す履歴は削除しない)
  - [2.5. 退避した作業を消す](#25-退避した作業を消す)
- [3. リモートブランチ関連](#3-リモートブランチ関連)
  - [3.1. ローカルブランチをリモートに追加](#31-ローカルブランチをリモートに追加)
  - [3.2. リモートブランチをローカルに持ってくる](#32-リモートブランチをローカルに持ってくる)
  - [3.3. リモートリポジトリを削除する](#33-リモートリポジトリを削除する)

## 1. 基礎

最初にコミット作業を行うと master ブランチと呼ばれるブランチが作成され、このブランチにたいしてコミットが行われる。  
この masterブランチはgithub上でデフォルトで表示されるブランチとなるため、このブランチを主流として他のブランチを派生して並行作業を行い、変更をmasterブランチに取り込んでいく形式が取られる。  


### 1.1. ブランチの作成

新規ブランチを作成したい場合は枝分かれしたいブランチ上で以下のコマンドを行う。
```bash
git branch <ANY_NAME> # ブランチの作成
git branch # 既存ブランチの表示
```

### 1.2. ブランチの移動

作成したブランチに移動するには以下のコマンドで移動する
```bash
git checkout <BRANCH_NAME>
# 新規ファイルでない編集中のファイルがある場合は 
# git stash を使用して退避領域に編集中のファイルを退避する必要がある
# もしくは コミットして一時的に編集を終わらせる必要がある
```

### 1.3. ブランチ上でのコミット

移動したブランチでの開発は通常通りに行う。
変更したモノを追跡対象に追加してcommitを行うことで反映させる。
```bash
git add <ANY_FILE>
git commit -m "comment"
```

### 1.4. 変更の取り込み(Merge)

開発したブランチを他の`master`などのブランチに取り込ませることをマージと呼ぶ。  
マージの際にはブランチで編集しているファイルが同一の場合コンフリクトが発生することがある。  
コンフリクトが発生した際には以下のURL等を参考にしてコンフリクトを解消してほしい。
[https://www.r-staffing.co.jp/engineer/entry/20190927_1](https://www.r-staffing.co.jp/engineer/entry/20190927_1)

#### 1.4.1. ローカルのmasterブランチでの変更を取り込む際

```bash
# 適当にブランチを作成して編集をする
git branch edit
git checkout edit
git add hoge
git commit -m 

# masterに取り込む
git checkout master
git merge master
```

#### 1.4.2. リモートリポジトリの内容をローカルリポジトリの内容に反映させる

リモートリポジトリの内容をローカルリポジトリに反映するには以下の方法を使う  
コレは他のPCや他の人が編集した内容をローカルに反映させる際に使用する。

```bash
git fetch origin master # リモートリポジトリから更新情報をダウンロードする
git merge origin/master # 更新情報を取り込む
```

- 一括で行うコマンド( fetch + merge )
```bash
git pull origin master
```


## 2. 作業途中で別のブランチに移動

作業途中でブランチを移動する際に作業を退避しておく必要がある

### 2.1. 退避

```bash
$ git stash -u
```

### 2.2. 退避作業を見る

```bash
$ git stash list
```

### 2.3. 退避した作業を元に戻す（履歴も削除する）
```bash
$ git stash pop stash@{0} # FILO
```

### 2.4. 退避した作業を元に戻す(履歴は削除しない)
```bash
$ git stash apply stash@{0}
```

### 2.5. 退避した作業を消す
```bash
$ git stash drop stash@{0}
```


参考:<https://qiita.com/chihiro/items/f373873d5c2dfbd03250>
参考:<http://webdev.boy.jp/git%E4%BD%9C%E6%A5%AD%E9%80%94%E4%B8%AD%E3%81%A7%E5%88%A5%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%B8%E7%A7%BB%E5%8B%95%E3%81%97%E3%81%9F%E3%81%84/>

## 3. リモートブランチ関連

### 3.1. ローカルブランチをリモートに追加

作成したローカルブランチを master に反映せずにリモートに追加したい場合がある。
その際には以下のコマンドでリモートに追加することができる。
初回は以下のコマンドを用いる

```bash
git push -u origin BRANCH_NAME #初回
git push origin BRANCH_NAME # 二回目移行
```

- 参考
<https://blog.pokechoi.com/archives/1100>

### 3.2. リモートブランチをローカルに持ってくる

追加したリモートブランチをローカルに持ってくる場合、以下の工程が必要である。
1. リモート追跡ブランチ(`orgin/hoge`)に `fetch` コマンドを使ってダウンロード
1. 追跡ブランチから`checkout -b`コマンドを使ってローカルブランチを作成する。

```bash
git fetch origin BRANCH_NAME
git checkout -b NEW_BRANCH origin/BRANCH_NAME
```

- 参考
<https://qiita.com/bitarx/items/ad47c9b91ae9c8272b3f>

### 3.3. リモートリポジトリを削除する

リモートブランチが必要なくなった時に削除する際には以下のコマンドで削除できる。  
(例えばブランチを実行環境で動作確認した後にmasterへ取り組んだとか)

```bash
git push --delete origin BRANCH_NAME
```



